<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>CRUD Pengunjung - Agus Siswanto</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background: #f8ede3; margin: 0; padding: 20px; }
    .container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);}
    h1 { text-align: center; color: #6d4c41; }
    form { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; }
    input, button { padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
    input { flex: 1; }
    button { background: #6d4c41; color: white; cursor: pointer; }
    button:hover { background: #8d6e63; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #6d4c41; color: white; }
    td button { margin-right: 6px; border: none; padding: 5px 10px; border-radius: 5px; }
    .edit { background: #ffb300; color: #fff; }
    .delete { background: #d32f2f; color: #fff; }
  </style>
</head>
<body>
  <div class="container">
    <h1>CRUD Data Pengunjung</h1>

    <form id="formPengunjung">
      <input type="hidden" id="id">
      <input type="text" id="nama_anak" placeholder="Nama Anak" required>
      <input type="number" id="umur" placeholder="Umur" required>
      <input type="text" id="nama_pendamping" placeholder="Nama Pendamping" required>
      <input type="text" id="no_hp" placeholder="No. HP" required>
      <input type="text" id="alamat" placeholder="Alamat" required>
      <button type="submit">Simpan</button>
    </form>

    <table id="dataTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nama Anak</th>
          <th>Umur</th>
          <th>Pendamping</th>
          <th>No. HP</th>
          <th>Alamat</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const baseUrl = "http://agussiswanto7005.free.nf/agus_playground/records/pengunjung";
    const form = document.getElementById('formPengunjung');
    const tableBody = document.querySelector('#dataTable tbody');

    async function loadData() {
      const res = await fetch(baseUrl);
      const data = await res.json();
      const records = data.records || [];
      tableBody.innerHTML = records.map(r => `
        <tr>
          <td>${r.id}</td>
          <td>${r.nama_anak}</td>
          <td>${r.umur}</td>
          <td>${r.nama_pendamping}</td>
          <td>${r.no_hp}</td>
          <td>${r.alamat}</td>
          <td>
            <button class="edit" onclick='editData(${JSON.stringify(r)})'>Edit</button>
            <button class="delete" onclick='hapusData(${r.id})'>Hapus</button>
          </td>
        </tr>
      `).join('');
    }

    async function tambahData(e) {
      e.preventDefault();
      const id = form.id.value;
      const payload = {
        nama_anak: form.nama_anak.value,
        umur: form.umur.value,
        nama_pendamping: form.nama_pendamping.value,
        no_hp: form.no_hp.value,
        alamat: form.alamat.value
      };

      if (id) {
        // UPDATE (PUT)
        await fetch(`${baseUrl}/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        alert("Data berhasil diperbarui!");
      } else {
        // CREATE (POST)
        await fetch(baseUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        alert("Data berhasil ditambahkan!");
      }

      form.reset();
      loadData();
    }

    function editData(data) {
      form.id.value = data.id;
      form.nama_anak.value = data.nama_anak;
      form.umur.value = data.umur;
      form.nama_pendamping.value = data.nama_pendamping;
      form.no_hp.value = data.no_hp;
      form.alamat.value = data.alamat;
    }

    async function hapusData(id) {
      if (confirm("Yakin hapus data ini?")) {
        await fetch(`${baseUrl}/${id}`, { method: "DELETE" });
        alert("Data berhasil dihapus!");
        loadData();
      }
    }

    form.addEventListener('submit', tambahData);
    loadData();
  </script>
</body>
</html>
